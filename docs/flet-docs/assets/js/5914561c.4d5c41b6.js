"use strict";(self.webpackChunkflet_dev=self.webpackChunkflet_dev||[]).push([[93175],{91763:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>d});var a=t(74848),o=t(28453);const i={title:"Making a Trello clone with Python and Flet",sidebar_label:"Trello clone",slug:"trello-clone"},l=void 0,s={id:"tutorials/trello-clone",title:"Making a Trello clone with Python and Flet",description:"Lets make a clone of Trello in Python with the Flet framework and then deploy it to fly.io!",source:"@site/docs/tutorials/trello-clone.md",sourceDirName:"tutorials",slug:"/tutorials/trello-clone",permalink:"/docs/flet-docs/docs/tutorials/trello-clone",draft:!1,unlisted:!1,editUrl:"https://github.com/flet-dev/website/edit/main/docs/tutorials/trello-clone.md",tags:[],version:"current",frontMatter:{title:"Making a Trello clone with Python and Flet",sidebar_label:"Trello clone",slug:"trello-clone"},sidebar:"docs",previous:{title:"Calculator app",permalink:"/docs/flet-docs/docs/tutorials/python-calculator"},next:{title:"Solitaire game",permalink:"/docs/flet-docs/docs/tutorials/python-solitaire"}},r={},d=[{value:"Why Flet?",id:"why-flet",level:2},{value:"Defining Entities and Layout",id:"defining-entities-and-layout",level:2},{value:"Data Access Layer and Customization",id:"data-access-layer-and-customization",level:2},{value:"Application Logic",id:"application-logic",level:2},{value:"Creating Views",id:"creating-views",level:3},{value:"Syncing Navigation Panel",id:"syncing-navigation-panel",level:3},{value:"Routing",id:"routing",level:3},{value:"Changing Board Names",id:"changing-board-names",level:3},{value:"Drag and Drop",id:"drag-and-drop",level:2},{value:"Handling Page Resizing",id:"handling-page-resizing",level:2},{value:"Deploying as Web App",id:"deploying-as-web-app",level:2},{value:"Summary",id:"summary",level:2}];function c(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["Lets make a clone of Trello in Python with the Flet framework and then deploy it to ",(0,a.jsx)(n.a,{href:"https://fly.io/",children:"fly.io"}),"!"]}),"\n",(0,a.jsx)("img",{src:"/img/docs/trolli-tutorial/trolli-app.gif",className:"screenshot-80"}),"\n",(0,a.jsxs)(n.p,{children:["The code for this tutorial can be found ",(0,a.jsx)(n.a,{href:"https://github.com/flet-dev/examples/tree/main/python/apps/trolli",children:"here"})," with self explanatory commits. Be sure to run ",(0,a.jsx)(n.code,{children:"pip install -r requirements.txt"})," after cloning. And ",(0,a.jsx)(n.a,{href:"https://gallery.flet.dev/trolli/",children:"here"})," is a live demo."]}),"\n",(0,a.jsx)(n.h2,{id:"why-flet",children:"Why Flet?"}),"\n",(0,a.jsx)(n.p,{children:"Most developers are undoubtedly familiar with the situation of either having developed a console app that turns out to have a wider audience than originally intended, or needing to develop an internal tool for non-developers but which is destined to have a small user base and/or a relatively brief shelf life. In situations like these it can often feel awkward to reach for an oversized tool such as electron, a feature rich framework like flutter (irony acknowledged!), or try to quickly get a handle on some other cross platform framework like .NET MAUI. What we would really like is to be able to throw a UI on our logic that looks generically decent, has acceptable performance, and ideally, takes less time to write than did the business logic, and preferably in the same language in which the rest of the logic was written - i.e. a language with which we are already proficient (currently the only released library is in Python but C#, Typescript, and Golang libraries are on the roadmap). This is exactly what the Flet platform aims to provide."}),"\n",(0,a.jsx)(n.p,{children:"Flet takes a different approach to many new UI frameworks that is arguably more intuitive to the majority of experienced programmers. Diverging from the currently ubiquitous declarative approach and opting instead for an imperative model."}),"\n",(0,a.jsxs)(n.p,{children:["Having intimated that Flet is designed with simple GUIs in mind, lets nonetheless try to make something a tad more complicated than, for example, a simple dashboard with some filters, and shoot for something like a minimal version of Trello - and bestow upon it the totally-independently-arrived-at-name, ",(0,a.jsx)(n.em,{children:"Trolli"}),".  For the purposes of this tutorial I'll assume the reader is familiar with the basic concept and setup of a Flet project (read ",(0,a.jsx)(n.a,{href:"https://flet.dev/docs/tutorials",children:"the tutorials"})," and the ",(0,a.jsx)(n.a,{href:"https://flet.dev/docs",children:"docs"})," if not), and instead focus more on aspects that are not part of the existing tutorials."]}),"\n",(0,a.jsx)(n.h2,{id:"defining-entities-and-layout",children:"Defining Entities and Layout"}),"\n",(0,a.jsxs)(n.p,{children:["With the proximate goal of creating the MVP of our clone, let's start by defining the main entities (",(0,a.jsx)(n.code,{children:"boards"}),", ",(0,a.jsx)(n.code,{children:"board_lists"}),", ",(0,a.jsx)(n.code,{children:"items"}),"), settle on an acceptable design and layout, and implement a sort of pseudo-repository pattern so that in future development we can move from in-memory data storage to persistent storage of some kind."]}),"\n",(0,a.jsxs)(n.p,{children:["Here, in the ",(0,a.jsx)(n.code,{children:"main.py"})," module we'll add this code and then continue to define the ",(0,a.jsx)(n.code,{children:"TrelloApp"})," class."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import flet\nfrom flet import (\n    Page,\n    colors\n)\n \nif __name__ == "__main__":\n \n    def main(page: Page):\n \n        page.title = "Flet Trello clone"\n        page.padding = 0\n        page.bgcolor = colors.BLUE_GREY_200\n        app = TrelloApp(page)\n        page.add(app)\n        page.update()\n \n    flet.app(main, view=flet.WEB_BROWSER)\n'})}),"\n",(0,a.jsxs)(n.p,{children:["In terms of layout we can consider the app to consist of a header (",(0,a.jsx)(n.code,{children:"appbar"}),") and below that a collapsible navigation panel, next to which is the active view consisting of either a board, settings, members or whatever else we may choose. Something like this..."]}),"\n",(0,a.jsx)("img",{src:"/img/docs/trolli-tutorial/mock-up.png",className:"screenshot-80"}),"\n",(0,a.jsx)(n.p,{children:"So the class for the app itself could look something like this..."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'from flet import (\n    Container,\n    Icon,\n    Page,\n    Text,\n    AppBar,\n    PopupMenuButton,\n    PopupMenuItem,\n    colors,\n    icons,\n    margin\n)\n \nclass TrelloApp:\n    def __init__(self, page: Page):\n        self.page = page\n        self.appbar_items = [\n            PopupMenuItem(text="Login"),\n            PopupMenuItem(),  # divider\n            PopupMenuItem(text="Settings")\n        ]\n        self.appbar = AppBar(\n            leading=Icon(icons.GRID_GOLDENRATIO_ROUNDED),\n            leading_width=100,\n            title=Text("Trolli",size=32, text_align="start"),\n            center_title=False,\n            toolbar_height=75,\n            bgcolor=colors.LIGHT_BLUE_ACCENT_700,\n            actions=[\n                Container(\n                    content=PopupMenuButton(\n                        items=self.appbar_items\n                    ),\n                    margin=margin.only(left=50, right=25)\n                )\n            ],\n        )\n        self.page.appbar = self.appbar\n        self.page.update()\n'})}),"\n",(0,a.jsxs)(n.p,{children:["In a new file (",(0,a.jsx)(n.code,{children:"app_layout.py"}),") we can define a layout for our app in a class which will inherit from the ",(0,a.jsx)(n.code,{children:"Row"})," control and in which the navigation rail along with a toggle button to collapse and expand it, and the main content area are laid out. But rather than define the navigation sidebar in that module, we'll place that in its own ",(0,a.jsx)(n.code,{children:"sidebar.py"})," module. We'll also build the sidebar class as a ",(0,a.jsx)(n.code,{children:"UserControl"})," so that it can be updated independently of the ",(0,a.jsx)(n.code,{children:"AppLayout"})," class."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'from flet import (\n    Control,\n    Column,\n    Container,\n    IconButton,\n    Page,\n    Row,\n    Text,\n    IconButton,\n    colors,\n    icons,\n)\nfrom sidebar import Sidebar\n \n \nclass AppLayout(Row):\n    def __init__(\n        self,\n        app,\n        page: Page,\n        *args,\n        **kwargs\n    ):\n        super().__init__(*args, **kwargs)\n        self.app = app\n        self.page = page\n        self.toggle_nav_rail_button = IconButton(\n            icon=icons.ARROW_CIRCLE_LEFT, icon_color=colors.BLUE_GREY_400, selected=False,\n            selected_icon=icons.ARROW_CIRCLE_RIGHT, on_click=self.toggle_nav_rail)\n        self.sidebar = Sidebar(self, page)\n        self._active_view: Control = Column(controls=[\n            Text("Active View")\n        ], alignment="center", horizontal_alignment="center")\n        self.controls = [self.sidebar,\n                         self.toggle_nav_rail_button, self.active_view]\n \n    @property\n    def active_view(self):\n        return self._active_view\n \n    @active_view.setter\n    def active_view(self, view):\n        self._active_view = view\n        self.update()\n \n    def toggle_nav_rail(self, e):\n        self.sidebar.visible = not self.sidebar.visible\n        self.toggle_nav_rail_button.selected = not self.toggle_nav_rail_button.selected\n        self.page.update()\n'})}),"\n",(0,a.jsxs)(n.p,{children:["And here is the ",(0,a.jsx)(n.code,{children:"Sidebar.py"})," file."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'from flet import (\n    UserControl,\n    Column,\n    Container,\n    Row,\n    Text,\n    NavigationRail,\n    NavigationRailDestination,\n    alignment,\n    border_radius,\n    colors,\n    icons,\n    padding,\n    margin,\n)\n \n \nclass Sidebar(UserControl):\n \n    def __init__(self, app_layout, page):\n        super().__init__()\n        self.app_layout = app_layout\n        self.page = page\n        self.top_nav_items = [\n            NavigationRailDestination(\n                label_content=Text("Boards"),\n                label="Boards",\n                icon=icons.BOOK_OUTLINED,\n                selected_icon=icons.BOOK_OUTLINED\n            ),\n            NavigationRailDestination(\n                label_content=Text("Members"),\n                label="Members",\n                icon=icons.PERSON,\n                selected_icon=icons.PERSON\n            ),\n \n        ]\n        self.top_nav_rail = NavigationRail(\n            selected_index=None,\n            label_type="all",\n            on_change=self.top_nav_change,\n            destinations=self.top_nav_items,\n            bgcolor=colors.BLUE_GREY,\n            extended=True,\n            expand=True\n        )\n \n    def build(self):\n        self.view = Container(\n            content=Column([\n                Row([\n                    Text("Workspace"),\n                ]),\n                # divider\n                Container(\n                    bgcolor=colors.BLACK26,\n                    border_radius=border_radius.all(30),\n                    height=1,\n                    alignment=alignment.center_right,\n                    width=220\n                ),\n                self.top_nav_rail,\n                # divider\n                Container(\n                    bgcolor=colors.BLACK26,\n                    border_radius=border_radius.all(30),\n                    height=1,\n                    alignment=alignment.center_right,\n                    width=220\n                ),\n            ], tight=True),\n            padding=padding.all(15),\n            margin=margin.all(0),\n            width=250,\n            bgcolor=colors.BLUE_GREY,\n        )\n        return self.view\n \n    def top_nav_change(self, e):\n        self.top_nav_rail.selected_index = e.control.selected_index\n        self.update()\n\n'})}),"\n",(0,a.jsx)(n.p,{children:"If we run the main app with"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"flet main.py -d\n"})}),"\n",(0,a.jsxs)(n.p,{children:["we can see the result and get hot reloading when we make any style changes. For example, try adding ",(0,a.jsx)(n.code,{children:'alignment="center"'})," to the first row in the container like this\u2026"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'content=Column([\n        Row([Text("Workspace")], alignment="center")\n'})}),"\n",(0,a.jsx)(n.p,{children:"If you save the file you should be able to see the change in your app window."}),"\n",(0,a.jsx)("img",{src:"/img/docs/trolli-tutorial/basic-nav-rail-toggle.gif",className:"screenshot-60"}),"\n",(0,a.jsxs)(n.p,{children:["Before we move on let's define our basic entities. We'll need a ",(0,a.jsx)(n.code,{children:"Board"})," class, which will keep a list of lists, each of which will be a ",(0,a.jsx)(n.code,{children:"BoardList"})," object (apologies for the unfortunate lexical collisions here - the colloquial use of 'list' derives from the nature of the app, whereas the technical use of 'list' derives from python's particular term for an array-like data structure), and each of which, in turn, will contain a list of ",(0,a.jsx)(n.code,{children:"Item"})," objects. If that's confusing, take some time to look over the source code to clear things up."]}),"\n",(0,a.jsxs)(n.p,{children:["For each of the entities, we'll add an application wide unique id with an ",(0,a.jsx)(n.code,{children:"id_counter = itertools.count()"})," statement at the top of each class and a call to ",(0,a.jsx)(n.code,{children:"next(Board.id_counter)"})," at initialization. This way two lists or boards can have the same name but still represent distinct entities."]}),"\n",(0,a.jsx)(n.h2,{id:"data-access-layer-and-customization",children:"Data Access Layer and Customization"}),"\n",(0,a.jsxs)(n.p,{children:["Now that we have a basic layout and entities defined, let's add a few customization parameters to the app itself. Lets also take some time to create a basic data access interface. You can see the boiler plate for the interface and the in-memory implementation in the ",(0,a.jsx)(n.code,{children:"data_store.py"})," and ",(0,a.jsx)(n.code,{children:"memory_store.py"})," files respectively. This will make it easier for us to swap in some persistent storage solution in a future tutorial."]}),"\n",(0,a.jsxs)(n.p,{children:["Here is the updated main function. We need to instantiate the ",(0,a.jsx)(n.code,{children:"InMemoryStore"})," class within the main method so that each user session (i.e. each new tab using the app), has it's own version of the store. We'll then need to pass that store to each of the components that will need access to it."]}),"\n",(0,a.jsxs)(n.p,{children:["We'll also add a new font in an ",(0,a.jsx)(n.em,{children:"assets"})," directory, which is specified in the named argument to the app function."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'if __name__ == "__main__":\n \n    def main(page: Page):\n \n        page.title = "Flet Trello clone"\n        page.padding = 0\n        page.theme = theme.Theme(\n            font_family="Verdana")\n        page.theme.page_transitions.windows = "cupertino"\n        page.fonts = {\n            "Pacifico": "/Pacifico-Regular.ttf"\n        }\n        page.bgcolor = colors.BLUE_GREY_200\n        page.update()\n        app = TrelloApp(page)\n \n    flet.app(main, assets_dir="../assets", view=flet.WEB_BROWSER)\n'})}),"\n",(0,a.jsx)(n.h2,{id:"application-logic",children:"Application Logic"}),"\n",(0,a.jsx)(n.p,{children:"You can run the app now but apart from a nicer font for the name, it still does not have any functionality. Now it's time to fill out the application logic. Although this app might qualify as non-trivial, we won't bother to separate the code into distinct application and business layers. The separation of the data access and the rest of the logic will suffice for this non-architecturally focused tutorial, though further separation may be a sensible thing to consider."}),"\n",(0,a.jsx)(n.h3,{id:"creating-views",children:"Creating Views"}),"\n",(0,a.jsxs)(n.p,{children:["First up, we will add views to correspond to the sidebar navigation destinations. We need a view to display all boards and a view to display a Members pane which, for now, will simply be a placeholder until a future tutorial. We'll add these views as controls to the ",(0,a.jsx)(n.code,{children:"app_layout.py"})," module."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'self.members_view = Text("members view")\n\nself.all_boards_view = Column([\n    Row([\n        Container(\n            Text(value="Your Boards", style="headlineMedium"),\n            expand=True,\n            padding=padding.only(top=15)),\n        Container(\n            TextButton(\n                "Add new board",\n                icon=icons.ADD,\n                on_click=self.app.add_board,\n                style=ButtonStyle(\n                    bgcolor={\n                        "": colors.BLUE_200,\n                        "hovered": colors.BLUE_400\n                    },\n                    shape={\n                        "": RoundedRectangleBorder(radius=3)\n                    }\n                )\n            ),\n\n            padding=padding.only(right=50, top=15))\n    ]),\n    Row([\n        TextField(hint_text="Search all boards", autofocus=False, content_padding=padding.only(left=10),\n                    width=200, height=40, text_size=12,\n                    border_color=colors.BLACK26, focused_border_color=colors.BLUE_ACCENT, suffix_icon=icons.SEARCH)\n    ]),\n    Row([Text("No Boards to Display")])\n], expand=True)\n\n'})}),"\n",(0,a.jsx)(n.p,{children:"Since we are working in an imperative paradigm and have no explicit state management tool such as redux or the like, we will need a method to 'rehydrate' the view that shows all the boards so that its current state reflects changes made in other entities (namely the sideboard)."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'def hydrate_all_boards_view(self):\n    self.all_boards_view.controls[-1] = Row([\n        Container(\n            content=Row([\n                Container(\n                    content=Text(value=b.name), data=b, expand=True, on_click=self.board_click),\n                Container(\n                    content=PopupMenuButton(\n                        items=[\n                            PopupMenuItem(\n                                content=Text(value="Delete", style="labelMedium",\n                                                text_align="center"),\n                                on_click=self.app.delete_board, data=b),\n                            PopupMenuItem(),\n                            PopupMenuItem(\n                                content=Text(value="Archive", style="labelMedium",\n                                                text_align="center"),\n                            )\n                        ]\n                    ),\n                    padding=padding.only(right=-10),\n                    border_radius=border_radius.all(3)\n                )], alignment="spaceBetween"),\n            border=border.all(1, colors.BLACK38),\n            border_radius=border_radius.all(5),\n            bgcolor=colors.WHITE60,\n            padding=padding.all(10),\n            width=250,\n            data=b\n        ) for b in self.store.get_boards()\n    ], wrap=True)\n    self.sidebar.sync_board_destinations()\n'})}),"\n",(0,a.jsx)(n.h3,{id:"syncing-navigation-panel",children:"Syncing Navigation Panel"}),"\n",(0,a.jsxs)(n.p,{children:["Next up we need a visually distinct section of the navigation panel to display boards we've created. We'll add a second, ",(0,a.jsx)(n.code,{children:"bottom_nav_rail"})," to the sidebar to represent when a particular board is the active view. This will necessitate a ",(0,a.jsx)(n.code,{children:"sync_board_destinations"})," method in the sidebar component to be called whenever any change has been made to the list of current boards.\nWe'll now have a change handler for each of the top and bottom nav rails."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'self.top_nav_rail = NavigationRail(\n    selected_index=None,\n    label_type="all",\n    on_change=self.top_nav_change,\n    destinations=self.top_nav_items,\n    bgcolor=colors.BLUE_GREY,\n    extended=True,\n    height=110\n)\nself.bottom_nav_rail = NavigationRail(\n    selected_index=None,\n    label_type="all",\n    on_change=self.bottom_nav_change,\n    extended=True,\n    expand=True,\n    bgcolor=colors.BLUE_GREY,\n)\n\n...\n\ndef sync_board_destinations(self):\n    boards = self.store.get_boards()\n    self.bottom_nav_rail.destinations = []\n    for i in range(len(boards)):\n        b = boards[i]\n        self.bottom_nav_rail.destinations.append(\n            NavigationRailDestination(\n                label_content=TextField(\n                    value=b.name,\n                    hint_text=b.name,\n                    text_size=12,\n                    read_only=True,\n                    on_focus=self.board_name_focus,\n                    on_blur=self.board_name_blur,\n                    border="none",\n                    height=50,\n                    width=150,\n                    text_align="start",\n                    data=i\n                ),\n                label=b.name,\n                selected_icon=icons.CHEVRON_RIGHT_ROUNDED,\n                icon=icons.CHEVRON_RIGHT_OUTLINED\n            )\n        )\n    self.view.update()\n      \n'})}),"\n",(0,a.jsx)(n.p,{children:"Now we can add new boards and they appear in our navigation rail.\nUnfortunately clicking on the navigation rail doesn't actually navigate to anything."}),"\n",(0,a.jsx)("img",{src:"/img/docs/trolli-tutorial/add-board-capability.gif",className:"screenshot-60"}),"\n",(0,a.jsxs)(n.p,{children:["There are several ways we could achieve this such as having every view present in the ",(0,a.jsx)(n.code,{children:"app_layout.py"})," module and then toggling visibility on/off of the relevant views depending on the navigation rail index. But that wouldn't help much in a browser context, nor in a mobile context with a back button. We'll need to consider routing. Flet provides a ",(0,a.jsx)(n.code,{children:"TemplateRoute"})," utility class for url matching."]}),"\n",(0,a.jsx)(n.h3,{id:"routing",children:"Routing"}),"\n",(0,a.jsxs)(n.p,{children:["In the ",(0,a.jsx)(n.code,{children:"main.py"})," module let's wire up a handler to the ",(0,a.jsx)(n.code,{children:"page.on_route_change"})," event."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'Class TrelloApp:\n    def __init__(self, page: Page, user=None):\n \t\u2026 \n        self.page.on_route_change = self.route_change\n\t\u2026\n \n \n    def initialize(self):\n        self.page.views.append(\n            View(\n                "/",\n                [\n                    self.appbar,\n                    self.layout\n                ],\n                padding=padding.all(0),\n                bgcolor=colors.BLUE_GREY_200\n            )\n        )\n        self.page.update()\n        # create an initial board for demonstration\n        self.create_new_board("My First Board")\n        self.page.go("/")\n \n    def route_change(self, e):\n        troute = TemplateRoute(self.page.route)\n        if troute.match("/"):\n            self.page.go("/boards")\n        elif troute.match("/board/:id"):\n            if int(troute.id) > len(self.store.get_boards()):\n                self.page.go("/")\n                return\n            self.layout.set_board_view(int(troute.id))\n        elif troute.match("/boards"):\n            self.layout.set_all_boards_view()\n        elif troute.match("/members"):\n            self.layout.set_members_view()\n        self.page.update()\n'})}),"\n",(0,a.jsxs)(n.p,{children:["While here, we'll also change our initialization method so that the app starts with a pre-made board for demonstration purposes. Within that method note that we add a flet ",(0,a.jsx)(n.code,{children:"View"})," object to the page. The page maintains a list of Views as top level containers for other Controls in order to track navigation history. We'll need to add the corresponding ",(0,a.jsx)(n.code,{children:"set_***_view"})," methods to the ",(0,a.jsx)(n.code,{children:"layout.py"})," module as well. Here is the ",(0,a.jsx)(n.code,{children:"set_board_view"})," method for example..."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:" def set_board_view(self, i):\n        self.active_view = self.store.get_boards()[i]\n        self.sidebar.bottom_nav_rail.selected_index = i\n        self.sidebar.top_nav_rail.selected_index = None\n        self.sidebar.update()\n        self.page.update()\n"})}),"\n",(0,a.jsx)(n.p,{children:"Now, if we fire up the project in a web browser with the"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"flet main.py -d -w\n"})}),"\n",(0,a.jsxs)(n.p,{children:["command (",(0,a.jsx)(n.em,{children:"-d"})," flag for hot reloading, and ",(0,a.jsx)(n.em,{children:"-w"})," flag for web) we can add some boards and reach them by clicking or entering ",(0,a.jsx)(n.code,{children:"board/{i}"}),", where ",(0,a.jsx)(n.em,{children:"i"})," is the zero indexed board, as the url."]}),"\n",(0,a.jsx)("img",{src:"/img/docs/trolli-tutorial/navigation.gif",className:"screenshot-60"}),"\n",(0,a.jsx)(n.h3,{id:"changing-board-names",children:"Changing Board Names"}),"\n",(0,a.jsxs)(n.p,{children:['Next, we should include the ability to change the name of a board. In contrast to the more "',(0,a.jsx)(n.em,{children:"proper"}),'" title editing logic that was implemented in the ',(0,a.jsx)(n.code,{children:"board_list.py"})," module I'm going to favor what some might consider a more \"",(0,a.jsx)(n.em,{children:"hacky"}),"\" approach because I personally dislike overly ceremonial editing flows, particularly in such a low stakes, fluid sort of application. We'll make use of the ",(0,a.jsx)(n.code,{children:"on_focus"})," and ",(0,a.jsx)(n.code,{children:"on_blur"})," events in the bottom navigation rail destinations in the ",(0,a.jsx)(n.code,{children:"sidebar.py"})," module. Here are the handlers we'll add."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'def board_name_focus(self, e):\n    e.control.read_only = False\n    e.control.border = "outline"\n    e.control.update()\n\ndef board_name_blur(self, e):\n    self.store.update_board(self.store.get_boards()[e.control.data], {\n        \'name\': e.control.value})\n    self.app_layout.hydrate_all_boards_view()\n    e.control.read_only = True\n    e.control.border = "none"\n    self.page.update()\n\n'})}),"\n",(0,a.jsx)(n.p,{children:"This makes for a very intuitive way to change a board name without unnecessary dialogs or extraneous button presses."}),"\n",(0,a.jsxs)(n.p,{children:["Let's also quickly stub a login procedure which will be more fully realized in a future instalment. For now, we'll simply add the following login method and wire it up to the login ",(0,a.jsx)(n.code,{children:"PopupMenuItem"})," on_click event."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'def login(self, e):\n\n    def close_dlg(e):\n        if user_name.value == "" or password.value == "":\n            user_name.error_text = "Please provide username"\n            password.error_text = "Please provide password"\n            self.page.update()\n            return\n        else:\n            print("name and password: ", user_name.value, password.value)\n            user = User(user_name.value, password.value)\n            if user not in self.store.get_users():\n                self.store.add_user(user)\n            self.user = user_name.value\n            self.page.client_storage.set("current_user", user_name.value)\n\n        dialog.open = False\n        self.appbar_items[0] = PopupMenuItem(\n            text=f"{self.page.client_storage.get(\'current_user\')}\'s Profile")\n        self.page.update()\n    user_name = TextField(label="User name")\n    password = TextField(label="Password", password=True)\n    dialog = AlertDialog(\n        title=Text("Please enter your login credentials"),\n        content=Column([\n            user_name,\n            password,\n            ElevatedButton(text="Login", on_click=close_dlg),\n        ], tight=True),\n        on_dismiss=lambda e: print("Modal dialog dismissed!"),\n    )\n    self.page.dialog = dialog\n    dialog.open = True\n    self.page.update()\n'})}),"\n",(0,a.jsx)(n.h2,{id:"drag-and-drop",children:"Drag and Drop"}),"\n",(0,a.jsx)(n.p,{children:"Next, we'll add crucial drag and drop functionality to lists themselves and items within lists."}),"\n",(0,a.jsxs)(n.p,{children:["We'll start with the simpler case of re-ordering lists within boards. In order to give some visual indication of the target to which we're dragging a list, we'll modify the ",(0,a.jsx)(n.code,{children:"board_list"})," containers ",(0,a.jsx)(n.code,{children:"border"})," property, darkening the color on the ",(0,a.jsx)(n.code,{children:"list_will_drag_accept"})," event handler, and returning it to a lighter color in the ",(0,a.jsx)(n.code,{children:"list_drag_accept"})," and ",(0,a.jsx)(n.code,{children:"list_drag_leave"})," handlers."]}),"\n",(0,a.jsxs)(n.p,{children:["Next, we'll wrap the ",(0,a.jsx)(n.code,{children:"board_list"})," view in a ",(0,a.jsx)(n.code,{children:"DragTarget"})," object, all of which we will then wrap in a ",(0,a.jsx)(n.code,{children:"Draggable"})," object. Both of these will be passed a ",(0,a.jsx)(n.code,{children:"group"}),' parameter of "lists". This will be important since later we will want to add the ability to drag and drop individual items between different lists so for that function we\'ll specify a different group. If anything is unclear in the previous sentence. , have a look at the relevant ',(0,a.jsx)(n.a,{href:"https://flet.dev/docs/controls/draggable",children:"documentation"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"Now the composition of the view should look something like this."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'self.view = Draggable(\n    group="lists",\n    content=DragTarget(\n        group="lists",\n        content=Container(\n            content=Column([\n                self.header,\n                self.new_item_field,\n                TextButton(content=Row([Icon(icons.ADD), Text("add card", color=colors.BLACK38)], tight=True),\n                           on_click=self.add_item_handler),\n                self.items,\n                self.end_indicator\n            ], spacing=4, tight=True, data=self.title),\n            width=250,\n            border=border.all(2, colors.BLACK12),\n            border_radius=border_radius.all(5),\n            bgcolor=self.color if (\n                self.color != "") else colors.BACKGROUND,\n            padding=padding.only(\n                bottom=10, right=10, left=10, top=5)\n        ),\n        data=self,\n        on_accept=self.list_drag_accept,\n        on_will_accept=self.list_will_drag_accept,\n        on_leave=self.list_drag_leave\n    )\n)\n\n'})}),"\n",(0,a.jsx)(n.p,{children:"with the event handlers defined thus."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"def list_drag_accept(self, e):\n    src = self.page.get_control(e.src_id)\n    l = self.board.board_lists\n    to_index = l.index(e.control.data)\n    from_index = l.index(src.content.data)\n    l[to_index], l[from_index] = l[from_index], l[to_index]\n    self.inner_list.border = border.all(2, colors.BLACK12)\n    self.board.update()\n    self.update()\n\n\ndef list_will_drag_accept(self, e):\n    self.inner_list.border = border.all(2, colors.BLACK)\n    self.update()\n\n\ndef list_drag_leave(self, e):\n    self.inner_list.border = border.all(2, colors.BLACK12)\n    self.update()\n\n"})}),"\n",(0,a.jsx)(n.p,{children:"Note the manipulation of the opacity field acting as a visual indication that the dragged item will be accepted on the target."}),"\n",(0,a.jsx)("img",{src:"/img/docs/trolli-tutorial/drag-drop-list.gif",className:"screenshot-60"}),"\n",(0,a.jsxs)(n.p,{children:["Now for the slightly more complex case of dragging items within a list (including potentially to another list on the same board). Now that we want a ",(0,a.jsx)(n.code,{children:"board_list"})," to not only be a drag target for other lists, but also for items being dragged to it from a different list, we'll need to add another ",(0,a.jsx)(n.code,{children:"DragTarget"}),' wrapper to the list, but this time we\'ll assign the group name "items" so that it only responds to the dragging of items.']}),"\n",(0,a.jsxs)(n.p,{children:["Since we'll have the ability to drag the list to a location above or below an existing list we'll employ a different visual indicator strategy to what we've implemented for list dragging.\nWe'll make sure that every time a new ",(0,a.jsx)(n.code,{children:"item"})," is added to the ",(0,a.jsx)(n.code,{children:"board_list"})," it will be interspersed with a visual indicator (implemented as a simple Container object)."]}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"item.py"})," module will now need its view wrapped by ",(0,a.jsx)(n.code,{children:"Draggable"})," and ",(0,a.jsx)(n.code,{children:"DragTarget"}),' and assigned to the "items" group as seen below together with event handlers.']}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'def build(self):\n\n    self.view = Draggable(\n        group="items",\n        content=DragTarget(\n            group="items",\n            content=self.card_item,\n            on_accept=self.drag_accept,\n            on_leave=self.drag_leave,\n            on_will_accept=self.drag_will_accept,\n        ),\n        data=self\n    )\n    return self.view\n\ndef drag_accept(self, e):\n    src = self.page.get_control(e.src_id)\n\n    # skip if item is dropped on itself\n    if (src.content.content == e.control.content):\n        print("skip")\n        self.card_item.elevation = 1\n        self.list.set_indicator_opacity(self, 0.0)\n        e.control.update()\n        return\n\n    # item dropped within same list but not on self\n    if (src.data.list == self.list):\n        self.list.add_item(chosen_control=src.data,\n                            swap_control=self)\n        self.card_item.elevation = 1\n        e.control.update()\n        return\n\n    # item added to different list\n    self.list.add_item(src.data.item_text, swap_control=self)\n    # remove from the list to which draggable belongs\n    src.data.list.remove_item(src.data)\n    self.list.set_indicator_opacity(self, 0.0)\n    self.card_item.elevation = 1\n    e.control.update()\n\ndef drag_will_accept(self, e):\n    self.list.set_indicator_opacity(self, 1.0)\n    self.card_item.elevation = 20 if e.data == "true" else 1\n    e.control.update()\n\ndef drag_leave(self, e):\n    self.list.set_indicator_opacity(self, 0.0)\n    self.card_item.elevation = 1\n    e.control.update()\n'})}),"\n",(0,a.jsxs)(n.p,{children:["We need somewhere to house the logic that will decide on how and when to modify the items owned by a ",(0,a.jsx)(n.code,{children:"board_list"})," object based on a drag event. There are surely design pattern militants out there that will find several dozen unholy violations of the sacred order of clean software design in the following approach but for this size of application, simply overloading the ",(0,a.jsx)(n.code,{children:"add_item"})," method to take optional keyword args when called from different places, as seen below, seems to me like a perfectly workable approach."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'def add_item(self, item: str = None, chosen_control: Draggable = None swap_control: Draggable = None):\n\n    controls_list = [x.controls[1] for x in self.items.controls]\n    to_index = controls_list.index(\n        swap_control) if swap_control in controls_list else None\n    from_index = controls_list.index(\n        chosen_control) if chosen_control in controls_list else None\n    control_to_add = Column([\n        Container(\n            bgcolor=colors.BLACK26,\n            border_radius=border_radius.all(30),\n            height=3,\n            alignment=alignment.center_right,\n            width=200,\n            opacity=0.0\n        )\n    ])\n\n    # rearrange (i.e. drag drop from same list)\n    if ((from_index is not None) and (to_index is not None)):\n        self.items.controls.insert(\n            to_index, self.items.controls.pop(from_index))\n        self.set_indicator_opacity(swap_control, 0.0)\n\n    # insert (drag from other list to middle of this list)\n    elif (to_index is not None):\n        new_item = Item(self, item)\n        control_to_add.controls.append(new_item)\n        self.items.controls.insert(to_index, control_to_add)\n\n    # add new (drag from other list to end of this list, or use add item button)\n    else:\n        new_item = Item(self, item) if item else Item(\n            self, self.new_item_field.value)\n        control_to_add.controls.append(new_item)\n        self.items.controls.append(control_to_add)\n        self.store.add_item(self.board_list_id, new_item)\n        self.new_item_field.value = ""\n\n    self.view.update()\n    self.page.update()\n'})}),"\n",(0,a.jsx)(n.p,{children:"And with these changes, we should be able to drag lists around within the board and also drag items between different lists."}),"\n",(0,a.jsx)("img",{src:"/img/docs/trolli-tutorial/drag-lists-and-items.gif",className:"screenshot-60"}),"\n",(0,a.jsx)(n.h2,{id:"handling-page-resizing",children:"Handling Page Resizing"}),"\n",(0,a.jsx)(n.p,{children:"The only final bit of logic we need to add is some page resizing to ensure that if more lists exist than can be displayed, there is a scroll bar to reach them. This logic will also have to take into account the state of the sidebar - extended or not."}),"\n",(0,a.jsxs)(n.p,{children:["We'll add a resize method to ",(0,a.jsx)(n.code,{children:"board.py"})," module."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"def resize(self, nav_rail_extended, width, height):\n    self.list_wrap.width = (\n        width - 310) if nav_rail_extended else (width - 50)\n    self.view.height = height\n    self.list_wrap.update()\n    self.view.update()\n"})}),"\n",(0,a.jsxs)(n.p,{children:["and wire up this ",(0,a.jsx)(n.code,{children:"page.on_resize"})," handler in the ",(0,a.jsx)(n.code,{children:"app_layout.py"})," module."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"def page_resize(self, e=None):\n    if type(self.active_view) is Board:\n        self.active_view.resize(self.sidebar.visible,\n                                self.page.width, self.page.height)\n    self.page.update()\n"})}),"\n",(0,a.jsx)(n.h2,{id:"deploying-as-web-app",children:"Deploying as Web App"}),"\n",(0,a.jsxs)(n.p,{children:["When you run ",(0,a.jsx)(n.code,{children:"flet main.py"})," the Flet web server a.k.a ",(0,a.jsx)(n.em,{children:"Fletd"})," is started in order to send updates to the Flutter based UI. The communication between both the server and the UI, and the server and your client code, happens in WebSockets. Therefore, you should make sure that wherever you deploy your app there is sufficient WebSockets support. For this tutorial, we'll deploy to ",(0,a.jsx)(n.a,{href:"https://fly.io/",children:"fly.io"}),", which offers up to 3 VMs and 3GB storage on its free tier. If you are more accustomed to AWS services (or someone else is paying ","\ud83d\ude04","), you could consider adapting this deployment strategy to Fargate."]}),"\n",(0,a.jsxs)(n.p,{children:["Once you have ",(0,a.jsx)(n.a,{href:"https://fly.io/docs/hands-on/install-flyctl/",children:"installed the flyctl command line utility"}),", and created an account you can authenticate by running"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"fly auth login\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://fly.io/",children:"fly.io"})," works by creating micro-VMs based on a Docker container. As such, you'll need a ",(0,a.jsx)(n.code,{children:"DockerFile"})," in the root of your repository, and you'll also need a ",(0,a.jsx)(n.code,{children:"fly.toml"})," configuration file. The latter can also be created by running"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"fly launch\n"})}),"\n",(0,a.jsx)(n.p,{children:"in your repository and following the prompts. If need be you can refer to the named commits in the companion repo for this tutorial."}),"\n",(0,a.jsx)(n.p,{children:"Once you've verified that your docker image can be built and run locally, you can create your app by running"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"fly apps create --name <app-name>\n"})}),"\n",(0,a.jsx)(n.p,{children:"and then deploy with"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"fly deploy \n"})}),"\n",(0,a.jsx)(n.p,{children:"If the deployment is successful you should be able to visit the app by running"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"fly apps open\n"})}),"\n",(0,a.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsx)(n.p,{children:"Hopefully this walkthrough gives the reader some idea of how actual usable apps can be developed and deployed using the Flet framework. The flexibility, speed of development and developer experience make it a really compelling tool to reach for in many different use cases and there is an ever growing number of devs doing just that."})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>s});var a=t(96540);const o={},i=a.createContext(o);function l(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);