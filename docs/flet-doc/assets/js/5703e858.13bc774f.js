"use strict";(self.webpackChunkflet_dev=self.webpackChunkflet_dev||[]).push([[59124],{17600:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>d});var i=t(74848),s=t(28453);const o={title:"Large lists",sidebar_label:"Large lists"},r=void 0,a={id:"cookbook/large-lists",title:"Large lists",description:"You can use Column and Row controls to display lists in the most cases, but if the list contains hundreds or thousands of items Column and Row will be ineffective with lagging UI as they render all items at once even they are not visible at the current scrolling position.",source:"@site/docs/cookbook/large-lists.md",sourceDirName:"cookbook",slug:"/cookbook/large-lists",permalink:"/docs/flet-doc/docs/cookbook/large-lists",draft:!1,unlisted:!1,editUrl:"https://github.com/flet-dev/website/edit/main/docs/cookbook/large-lists.md",tags:[],version:"current",frontMatter:{title:"Large lists",sidebar_label:"Large lists"},sidebar:"docs",previous:{title:"Keyboard shortcuts",permalink:"/docs/flet-doc/docs/cookbook/keyboard-shortcuts"},next:{title:"Drag and drop",permalink:"/docs/flet-doc/docs/cookbook/drag-and-drop"}},l={},d=[{value:"ListView",id:"listview",level:2},{value:"GridView",id:"gridview",level:2},{value:"Batch updates",id:"batch-updates",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["You can use ",(0,i.jsx)(n.a,{href:"/docs/controls/column",children:(0,i.jsx)(n.code,{children:"Column"})})," and ",(0,i.jsx)(n.a,{href:"/docs/controls/row",children:(0,i.jsx)(n.code,{children:"Row"})})," controls to display lists in the most cases, but if the list contains hundreds or thousands of items ",(0,i.jsx)(n.code,{children:"Column"})," and ",(0,i.jsx)(n.code,{children:"Row"})," will be ineffective with lagging UI as they render all items at once even they are not visible at the current scrolling position."]}),"\n",(0,i.jsxs)(n.p,{children:["In the following example we are adding 5,000 text controls to a page. Page uses ",(0,i.jsx)(n.code,{children:"Column"})," as a default layout container:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import flet as ft\n\ndef main(page: ft.Page):\n    for i in range(5000):\n        page.controls.append(ft.Text(f"Line {i}"))\n    page.scroll = "always"\n    page.update()\n\nft.app(main, view=ft.AppView.WEB_BROWSER)\n'})}),"\n",(0,i.jsx)(n.p,{children:"Run the program and notice that it's not just it takes a couple of seconds to initially load and render all text lines on a page, but scrolling is slow and laggy too:"}),"\n",(0,i.jsx)("img",{src:"/img/docs/getting-started/scroll-column.gif",className:"screenshot-50"}),"\n",(0,i.jsxs)(n.p,{children:["For displaying lists with a lot of items use ",(0,i.jsx)(n.a,{href:"/docs/controls/listview",children:(0,i.jsx)(n.code,{children:"ListView"})})," and ",(0,i.jsx)(n.a,{href:"/docs/controls/gridview",children:(0,i.jsx)(n.code,{children:"GridView"})})," controls which render items on demand, visible at the current scrolling position only."]}),"\n",(0,i.jsx)(n.h2,{id:"listview",children:"ListView"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"/docs/controls/listview",children:(0,i.jsx)(n.code,{children:"ListView"})})," could be either vertical (default) or horizontal. ListView items are displayed one after another in the scroll direction."]}),"\n",(0,i.jsxs)(n.p,{children:["ListView already implements effective on demand rendering of its children, but scrolling performance could be further improved if you can set the same fixed height or width (for ",(0,i.jsx)(n.code,{children:"horizontal"}),' ListView) for all items ("extent"). This could be done by either setting absolute extent with ',(0,i.jsx)(n.code,{children:"item_extent"})," property or making the extent of all children equal to the extent of the first child by setting ",(0,i.jsx)(n.code,{children:"first_item_prototype"})," to ",(0,i.jsx)(n.code,{children:"True"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Let's output a list of 5,000 items using ListView control:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import flet as ft\n\ndef main(page: ft.Page):\n    lv = ft.ListView(expand=True, spacing=10)\n    for i in range(5000):\n        lv.controls.append(ft.Text(f"Line {i}"))\n    page.add(lv)\n\nft.app(main, view=ft.AppView.WEB_BROWSER)\n'})}),"\n",(0,i.jsx)(n.p,{children:"Now the scrolling is smooth and fast enough to follow mouse movements:"}),"\n",(0,i.jsx)("img",{src:"/img/docs/getting-started/scroll-listview.gif",className:"screenshot-50"}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["We used ",(0,i.jsx)(n.code,{children:"expand=True"})," in ListView constructor. In order to function properly, ListView must have a height (or width if ",(0,i.jsx)(n.code,{children:"horizontal"}),") specified. You could set an absolute size, e.g. ",(0,i.jsx)(n.code,{children:"ListView(height=300, spacing=10)"}),", but in the example above we make ListView to take all available space on the page, i.e. expand. Read more about ",(0,i.jsx)(n.a,{href:"/docs/controls#expand",children:(0,i.jsx)(n.code,{children:"Control.expand"})})," property."]})}),"\n",(0,i.jsx)(n.h2,{id:"gridview",children:"GridView"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"/docs/controls/gridview",children:(0,i.jsx)(n.code,{children:"GridView"})})," allows arranging controls into a scrollable grid."]}),"\n",(0,i.jsxs)(n.p,{children:['You can make a "grid" with ',(0,i.jsx)(n.code,{children:"ft.Column(wrap=True)"})," or ",(0,i.jsx)(n.code,{children:"ft.Row(wrap=True)"}),", for example:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import os\nimport flet as ft\n\nos.environ["FLET_WS_MAX_MESSAGE_SIZE"] = "8000000"\n\ndef main(page: ft.Page):\n    r = ft.Row(wrap=True, scroll="always", expand=True)\n    page.add(r)\n\n    for i in range(5000):\n        r.controls.append(\n            ft.Container(\n                ft.Text(f"Item {i}"),\n                width=100,\n                height=100,\n                alignment=ft.alignment.center,\n                bgcolor=ft.Colors.AMBER_100,\n                border=ft.border.all(1, ft.Colors.AMBER_400),\n                border_radius=ft.border_radius.all(5),\n            )\n        )\n    page.update()\n\nft.app(main, view=ft.AppView.WEB_BROWSER)\n'})}),"\n",(0,i.jsx)("img",{src:"/img/docs/getting-started/row-wrap-as-grid.png",className:"screenshot-50"}),"\n",(0,i.jsx)(n.p,{children:"Try scrolling and resizing the browser window - everything works, but very laggy."}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsxs)(n.p,{children:["At the start of the program we are setting the value of ",(0,i.jsx)(n.code,{children:"FLET_WS_MAX_MESSAGE_SIZE"})," environment variable to ",(0,i.jsx)(n.code,{children:"8000000"})," - this is the maximum size of WebSocket message in bytes that can be received by Flet Server rendering the page. Default size is 1 MB, but the size of JSON message describing 5,000 container controls would exceed 1 MB, so we are increasing allowed size to 8 MB."]}),(0,i.jsxs)(n.p,{children:["Squeezing large messages through WebSocket channel is, generally, not a good idea, so use ",(0,i.jsx)(n.a,{href:"#batch-updates",children:"batched updates"})," approach to control channel load."]})]}),"\n",(0,i.jsx)(n.p,{children:"GridView, similar to ListView, is very effective to render a lot of children. Let's implement the example above using GridView:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import os\nimport flet as ft\n\nos.environ["FLET_WS_MAX_MESSAGE_SIZE"] = "8000000"\n\ndef main(page: ft.Page):\n    gv = ft.GridView(expand=True, max_extent=150, child_aspect_ratio=1)\n    page.add(gv)\n\n    for i in range(5000):\n        gv.controls.append(\n            ft.Container(\n                ft.Text(f"Item {i}"),\n                alignment=ft.alignment.center,\n                bgcolor=ft.Colors.AMBER_100,\n                border=ft.border.all(1, ft.Colors.AMBER_400),\n                border_radius=ft.border_radius.all(5),\n            )\n        )\n    page.update()\n\nft.app(main, view=ft.AppView.WEB_BROWSER)\n'})}),"\n",(0,i.jsx)("img",{src:"/img/docs/getting-started/grid-view.png",className:"screenshot-50"}),"\n",(0,i.jsx)(n.p,{children:"With GridView scrolling and window resizing are smooth and responsive!"}),"\n",(0,i.jsxs)(n.p,{children:["You can specify either fixed number of rows or columns (runs) with ",(0,i.jsx)(n.code,{children:"runs_count"}),' property or the maximum size of a "tile" with ',(0,i.jsx)(n.code,{children:"max_extent"}),' property, so the number of runs can vary automatically. In our example we set the maximum tile size to 150 pixels and set its shape to "square" with ',(0,i.jsx)(n.code,{children:"child_aspect_ratio=1"}),". ",(0,i.jsx)(n.code,{children:"child_aspect_ratio"})," is the ratio of the cross-axis to the main-axis extent of each child. Try changing it to ",(0,i.jsx)(n.code,{children:"0.5"})," or ",(0,i.jsx)(n.code,{children:"2"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"batch-updates",children:"Batch updates"}),"\n",(0,i.jsxs)(n.p,{children:["When ",(0,i.jsx)(n.code,{children:"page.update()"})," is called a message is being sent to Flet server over WebSockets containing page updates since the last ",(0,i.jsx)(n.code,{children:"page.update()"}),". Sending a large message with thousands of added controls could make a user waiting for a few seconds until the messages is fully received and controls rendered."]}),"\n",(0,i.jsx)(n.p,{children:"To increase usability of your program and present the results to a user as soon as possible you can send page updates in batches. For example, the following program adds 5,100 child controls to a ListView in batches of 500 items:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import flet as ft\n\ndef main(page: ft.Page):\n\n    # add ListView to a page first\n    lv = ft.ListView(expand=1, spacing=10, item_extent=50)\n    page.add(lv)\n\n    for i in range(5100):\n        lv.controls.append(ft.Text(f"Line {i}"))\n        # send page to a page\n        if i % 500 == 0:\n            page.update()\n    # send the rest to a page\n    page.update()\n\nft.app(main, view=ft.AppView.WEB_BROWSER)\n'})}),"\n",(0,i.jsx)("img",{src:"/img/docs/getting-started/sending-page-updates-in-batches.png",className:"screenshot-50"})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var i=t(96540);const s={},o=i.createContext(s);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);